---
title: 微前端
date: 2024/09/01
tags:
 - 框架
categories:
 - 框架
---

- qiankun
- single-spa

## 微前端怎么调研的

### iframe

特点

- 接入比较简单
- 隔离非常稳完美

不足

- dom割裂感严重，弹框只能在iframe，而且有滚动条
- 通讯非常麻烦，而且刷新iframe url状态丢失
- 前进后退按钮无效

### qiankun

基于single-spa的微前端方案

特点

- html entry 的方式引入子应用，相比 js entry 极大的降低了应用改造的成本；
- 完备的沙箱方案，js 沙箱做了 SnapshotSandbox、LegacySandbox、ProxySandbox 三套渐进增强方案，css 沙箱做了 strictStyleIsolation、- - experimentalStyleIsolation 两套适用不同场景的方案；
- 做了静态资源预加载能力；

不足

- 适配成本比较高，工程化、生命周期、静态资源路径、路由等都要做一系列的适配工作；
- css沙箱采用严格隔离会有各种问题，js 沙箱在某些场景下执行性能下降严重；
- 无法同时激活多个子应用，也不支持子应用保活；
- 无法支持vite等esmodule脚本运行；

`window.__POWERED_BY_QIANKUN__`子应用判断是否qiankun,避免多次渲染
`__webpack_public_path__ = window.__INJECTED_PUBLIC_PATH_BY_QIANKUN__`:主子应用本地调试时，存在资源路径引用的问题
`devServer -> configg.headers -> Access-control-allow-origin: *`: 子应用需要把跨域打开，上线时需要在niginix层配置

1. 父应用中注册应用，指定挂在的点
2. 子应用中改写打包格式，只支持umd
3. 子应用改写


## 微前端qiankun的实现原理

qiankun是一个基于single-spa的微前端实现库，它能够帮助我们将多个独立的前端应用聚合成一个整体的应用。它的实现原理是通过监听路由变化，动态加载和卸载微应用，同时通过自定义事件系统来实现微应用之间的通信。

## 遇到的问题

## qiankun的css隔离和js隔离如何实现的

## 怎么做的主应用或子应用单独启动

## 子应用单独启动情况下怎么获取主应用的cookie信息

## proxySandbox和legacySandbox那个更好，为什么

## legacySandbox会存在变量污染吗

## legacysanbox是完全隔离吗，怎么实现完全隔离，在IE浏览器下怎么实现

## 参考

[微前端（无界）](https://juejin.cn/post/7212603829572911159?searchId=202409011729186123E565ABF9E29D14D2)
[qiankun微前端面试题](https://juejin.cn/post/7339417495566696511?searchId=202409012257009CFA4BE18AC675B9FA5C)
