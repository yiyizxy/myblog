---
title: 防抖和节流
date: 2024/07/01
tags:
 - javascript
categories:
 - javascript
---

简而言之，防抖是在事件停止触发后延迟执行函数，而节流是按照固定的时间间隔执行函数。

可以用坐电梯的例子来理解：

- 防抖：电梯第一个人进来后，等待15秒，倘若又有人进来，则等最后一个人进来后，再等待15秒，如没有人再进来，则执行事件
- 节流：电梯第一个人进来后，等待15秒后，执行事件

## 什么是防抖（Debounce）

如下图所示，防抖（Debounce）是指在事件被触发 delay 时间后再执行回调 function 函数，如果在这设置的 delay 时间内事件又被触发，则重新计时。这可以使用在些点击请求的事件上，避免因为用户的多次点击向后端发送多次请求。

![debounce](./assets/debounce/debounce.png 'debounce')

应用场景:

- 搜索框实时搜索
- 按钮点击
- 表单输入验证
- 浏览器窗口调整事件：当用户调整浏览器窗口大小时，会触发resize事件。使用防抖函数可以延迟resize事件的触发，只在用户停止调整窗口一段时间后才执行对应的操作，避免频繁的计算和布局操作。
- 鼠标移动事件：在一些特定的交互场景中，需要根据鼠标的移动位置做出相应的交互。使用防抖函数可以延迟鼠标移动事件的触发，只在用户停止移鼠标一段时间后才执行相应的操作，避免过度频繁的操作。

实现方式

```js
function debounce(func, time) {
    let timeout
    return function () {
        const context = this
        const args = arguments
        if (timeout) clearTimeout(timeout)
        timeout = setTimeout(() => {
            func.apply(context, args)
        }, time)
    }
}
```

## 什么是节流（Throttle）

如下图所示，节流（Throttle）是指规定一个单位时间（延迟 delay 时间），在这个单位时间内，只能有一次触发事件的回调函数执行，如果在同一个单位时间内某事件被触发多次，只有一次能生效。节流可以使用在 scroll 函数的事件监听上，通过事件节流来降低事件调用的频率。

![throttle](./assets/debounce/throttle.png 'throttle')

应用场景:

- 页面滚动事件：当用户滚动页面时，会频繁触发滚动事件。使用节流函数可以控制滚动事件的触发频率，避免过多的计算和渲染操作，提高页面的性能和流畅度。
- 窗口大小调整：当用户调整浏览器窗口大小时，会不断触发resize事件。使用节流函数可以限制resize事件的触发频率，以避免过度计算和布局操作。
- 频繁点击按钮：在某些场景下，点击按钮可能会触发重复的提交操作。使用节流函数可以限制按钮点击的触发频率，防止重复的提交。
- 动画场景: 避免短时间内多次触发动画引起性能问题
- 拖拽场景: 在某些场景下，频繁触发位置变动会造成性能问题，固定时间内只执行一次，防止超高频次触发位置变动

### 实现方式

#### 时间戳实现方式

```js
function throttle(func, time) {
    let prev
    return function() {
        const context = this
        const args = arguments
        const now =  +new Date()
        if (now - prev > time) {
            func.apply(context, args)
            prev = now
        }
    }
}
```

#### 定时器实现方式

```js
function throttle (func, time) {
    let timeout 
    return function() {
        const context = this
        const  args = arguments
        if (!timeout) {
            timeout = setTimeout(() => {
                timeout = null
                func.apply(context, arguments)
            }, time)
        }
    }
}
```
